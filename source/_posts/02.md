---
title: å¾®ä¿¡å°æ¸¸æˆæƒé™
date: 2025-05-09
categories: ['æ¸¸æˆå¼€å‘']
tags: ['Cocos']
---

# å¾®ä¿¡å°æ¸¸æˆæƒé™

## å¾®ä¿¡å°æ¸¸æˆæƒé™é—®é¢˜
å¾®ä¿¡å…¬ä¼—å¹³å° https://mp.weixin.qq.com/
1. æ•°æ®éšç§åè®®ï¼šéœ€è¦å»å¾®ä¿¡å¼€å‘è€…åå°å¼€å¯ç”¨æˆ·éšç§ä¿æŠ¤æŒ‡å¼•
ï¼Œå¹¶ä¸”**å¼€å¯æˆæƒå¼¹çª—æé†’**å¦åˆ™çœŸæœºæµ‹è¯•çš„æ—¶å€™æœ‰æ—¶å€™ä¼šæˆæƒæˆåŠŸï¼Œæœ‰æ—¶å€™ä¼šæˆæƒå¤±è´¥ï¼Œéƒ½æ˜¯æ³ª ğŸ˜­ğŸ˜­ğŸ˜­
2. ç”¨æˆ·ä¿¡æ¯æˆæƒæŒ‰é’®ï¼šå› ä¸ºå¾®ä¿¡å°ç¨‹åºé™åˆ¶åªèƒ½ç”±å…ˆåˆ›å»ºæˆæƒæŒ‰é’®ç„¶åç‚¹å‡»åæˆæƒã€‚å› æ­¤ï¼Œéœ€è¦æŠŠæˆæƒæŒ‰é’®åšæˆä¸€ä¸ªé€æ˜çš„æŒ‰é’®è¦†ç›–åœ¨cocosçš„Nodeä¸Šï¼ˆæˆ–è€…åœ¨è¿›å…¥æ¸¸æˆæ—¶åˆ›å»ºä¸€ä¸ªå…¨å±é€æ˜çš„æˆæƒæŒ‰é’®ï¼‰

## å¾®ä¿¡ç”¨æˆ·æƒé™æŒ‰é’®çš„è®¾ç½®åœ¨æŒ‡å®šä½ç½®é—®é¢˜
å½“è¿›è¡Œæ˜¾ç¤ºæ’è¡Œæ¦œæ—¶éœ€è¦åˆ›å»ºä¸€ä¸ªé€æ˜çš„æŒ‰é’®åœ¨æ˜¾ç¤ºæ’è¡Œæ¦œæŒ‰é’®ä¸Šé¢ï¼Œè¿™æ ·ç‚¹å‡»æŒ‰é’®æ—¶é¦–å…ˆä¼šè°ƒç”¨ç”¨æˆ·ä¿¡æ¯æˆæƒï¼Œæ‹¿åˆ°ç”¨æˆ·çš„æ˜µç§°ã€å¤´åƒã€openidï¼Œç„¶åéšè—æˆæƒæŒ‰é’®å³å¯
ä½†å½“æŸ¥çœ‹å¾®ä¿¡apiæ—¶ä¼šå‘ç°æˆæƒæŒ‰é’®éœ€è¦ä¼ ä¸€ä¸ªä½ç½®ä¿¡æ¯ï¼Œä½†æ˜¯åœ¨cocosä¸­ä½ç½®æ€ä¹ˆè®¾ç½®éƒ½ä¸å¯¹ï¼Ÿ

ä»¥é¡¹ç›®åˆ†è¾¨ç‡è®¾ç½® 640x1136
è‡ªé€‚åº”é‡‡ç”¨ fit widthä¸ºä¾‹
è®¾å¤‡ä¸º iphone 13proï¼ˆ390x844 | Dpr:3ï¼‰
``` js
// å½“å‰æ˜¾ç¤ºè®¾å¤‡çš„ç‰©ç†åƒç´ åˆ†è¾¨ç‡ä¸ CSS åƒç´ åˆ†è¾¨ç‡ä¹‹æ¯”ï¼Œå³Dprï¼ˆä¸€èˆ¬ä¸º2,3ç­‰ï¼‰
const ratio = screen.devicePixelRatio // æ­¤å¤„ä¸º 3
// è¿”å›æ¨ªè½´çš„ç¼©æ”¾æ¯”ï¼Œè¿™ä¸ªç¼©æ”¾æ¯”æ˜¯å°†ç”»å¸ƒåƒç´ åˆ†è¾¨ç‡æ”¾åˆ°è®¾è®¡åˆ†è¾¨ç‡çš„æ¯”ä¾‹
// å³ï¼š390x3/640=1.828125
const scale = view.getScaleX()
// è·å–çœŸå®ç¼©æ”¾çš„æ¯”ä¾‹
// å³ 1.828125/3 = 0.609375
const factor = scale / ratio
// æ±‚æœ€ç»ˆçš„æŒ‰é’®çš„å®½é«˜
const width = btnSize.width * factor;
const height = btnSize.height * factor;
// æ±‚æœ€ç»ˆçš„æŒ‰é’®çš„top,leftã€‚å› ä¸ºæˆ‘æŒ‰é’®æ—¶æ˜¯æ”¾åœ¨å±å¹•çš„å³ä¸‹ã€‚æ‰€ä»¥topéœ€è¦å°†å±å¹•é«˜-æŒ‰é’®é«˜-è·ç¦»ä¸‹çš„é—´è·å³å¯ï¼ŒleftåŒç†
const top = winSize.height / ratio - height - (80 * factor)
const left = winSize.width / ratio - width - (33 * factor)
```

æœ€ç»ˆå®Œæ•´ä»£ç å¦‚ä¸‹

``` js
const btnNodeUiTransform = btnNode.getComponent(UITransform);

const btnSize = btnNodeUiTransform;
const winSize = screen.windowSize;

// é€‚é…ä¸åŒæœºå‹æ¥åˆ›å»ºå¾®ä¿¡æˆæƒæŒ‰é’®
const ratio = screen.devicePixelRatio
const scale = view.getScaleX()
const factor = scale / ratio

const width = btnSize.width * factor;
const height = btnSize.height * factor;

const top = winSize.height / ratio - height - (80 * factor)
const left = winSize.width / ratio - width - (33 * factor)

this.userInfoButton = wx.createUserInfoButton({
	type: 'text',
	text: '',
	// @ts-ignore
	style: {
		left: left,
		top: top,
		width: width,
		height: height,
		backgroundColor: 'rgba(255, 255, 255, 0)',
	}
})

this.userInfoButton.onTap((res) => {
	if (res.userInfo) {
		console.log(res.userInfo)
		this.userInfoButton.hide();
	}	else {
		Toast.toast('ç”¨æˆ·ä¿¡æ¯æˆæƒå¤±è´¥')
	}
});

```

## å¾®ä¿¡æ’è¡Œæ¦œå¼€æ”¾å­åŸŸç»˜åˆ¶é—®é¢˜
1. é‡åˆ°æ’è¡Œæ¦œæ¸²æŸ“é—ªçƒçš„é—®é¢˜ï¼Ÿ

cocos å¼€æ”¾å­åŸŸæ¨¡æ¿ä¸­minigame-canvas-engineåº“çš„ç‰ˆæœ¬ä¸ºæ—§çš„ï¼Œè¯·å»githubæ‰¾åˆ°æœ€æ–°ä»£ç æ›¿æ¢åˆ°engine.jsæ–‡ä»¶ä¸­